CREATE TABLE users (
                     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                     nom VARCHAR(50) NOT NULL,
                     prenom VARCHAR(50) NOT NULL,
                     email VARCHAR(255) UNIQUE NOT NULL,
                     password VARCHAR(255) NOT NULL,
                     role VARCHAR(20) DEFAULT 'user',
                     is_active BOOLEAN DEFAULT true,
                     linkFacebook VARCHAR(255),
                     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                     CONSTRAINT chk_role CHECK (role IN ('user', 'admin'))
                 );


-- Table notifications
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Contenu
    type VARCHAR(50) NOT NULL CHECK (type IN (
        -- User notifications
        'user_welcome', 'user_booking_confirmed', 'user_payment_success', 'user_booking_cancelled',
        -- Admin notifications  
        'admin_new_user', 'admin_new_booking', 'admin_payment_received', 'admin_payment_failed'
    )),
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    
    -- Métadonnées
    is_read BOOLEAN DEFAULT false,
    action_url VARCHAR(500),
    metadata JSONB,
    
    -- Dates
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    
    -- Index
    CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Index pour performances
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_type ON notifications(type);



CREATE TABLE hotels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    city VARCHAR(100) NOT NULL,
    stars INTEGER CHECK (stars >= 1 AND stars <= 5),
    maps_url TEXT,
    address TEXT,
    images TEXT[], -- Tableau de strings (URLs d'images)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE trips (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    type VARCHAR(50) NOT NULL CHECK (type IN ('national','international','religieuse')),

    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,

    start_date DATE NOT NULL,
    end_date DATE NOT NULL,

    base_price DECIMAL(10,2) NOT NULL,

    images TEXT[] DEFAULT '{}', -- tableau de strings
    equipment_list TEXT,         -- HTML code

    destination_wilaya VARCHAR(100),
    destination_country VARCHAR(100),

    omra_category VARCHAR(50)
        CHECK (omra_category IN ('classic','vip') OR omra_category IS NULL),

    created_at TIMESTAMP DEFAULT NOW()
);


CREATE TABLE trip_hotels (
    trip_id UUID REFERENCES trips(id) ON DELETE CASCADE,
    hotel_id UUID REFERENCES hotels(id) ON DELETE CASCADE,
    description TEXT,
    PRIMARY KEY (trip_id, hotel_id)
);


CREATE TABLE trip_itineraries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    trip_id UUID REFERENCES trips(id) ON DELETE CASCADE,
    day_date DATE NOT NULL,
    activities TEXT
);

